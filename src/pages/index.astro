---
import GalleryLayout from "@layouts/galleryLayout.astro";
import { getWorkById } from "../utils/dataService";

// 直接从数据服务获取所有工作数据
const workList = await getWorkById("all");
---

<GalleryLayout title={"Gallery - yi"}>
  <main class="fade-in">
    <section class="max-w-[1440px] mx-auto">
      <h1 class="text-xl md:text-2xl font-bold mb-8 md:mb-12">Projects</h1>

      <div
        class="project-grid grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8 md:gap-x-6 md:gap-y-10"
      >
        {
          workList.map((work) => {
            // Safely access the first image in the array if it exists
            // Handle both API (array) and Fallback (string) data structures
            const coverUrl = Array.isArray(work.coverImage)
              ? work.coverImage.length > 0
                ? work.coverImage[0].url
                : ""
              : work.coverImage;

            return (
              <a
                href={`/${work.workName.replace(/ /g, "_")}`}
                class="project-item group flex flex-col gap-2 cursor-pointer"
              >
                <div class="relative overflow-hidden bg-gray-1 dark:bg-[#1a1a1a] aspect-square w-full">
                  {coverUrl && (
                    <img
                      src={coverUrl}
                      alt={work.workName}
                      class="w-full h-full object-cover transition-all duration-700 ease-out group-hover:scale-102"
                    />
                  )}
                </div>

                <div class="flex justify-between items-baseline mt-1">
                  <h2 class="text-[13px] font-bold transition-colors">
                    {work.workName}
                  </h2>
                  <span class="text-[10px] text-[#666] font-mono">
                    {work.year || "2023"}
                    {work.ongoing ? " — ongoing" : ""}
                  </span>
                </div>
              </a>
            );
          })
        }
      </div>
    </section>
  </main>
</GalleryLayout>

<style>
  .project-item {
    @apply transition-all duration-500 ease-in-out;
  }

  /* 默认保持明亮 (100% 亮度/不透明度) */
  .project-item {
    @apply opacity-100 grayscale-0 brightness-100;
  }

  /* 仅在支持 hover 的设备上应用交互效果 */
  @media (hover: hover) {
    /* 当容器被悬停时，所有项目变暗/变灰 */
    .project-grid:hover .project-item {
      @apply opacity-30 grayscale-[0.5] brightness-75;
    }

    /* 当前悬停的项目保持/恢复亮起 */
    .project-grid:hover .project-item:hover {
      @apply opacity-100 grayscale-0 brightness-100;
    }

    /* 文字颜色同步交互 */
    .project-grid:hover .project-item h2 {
      @apply text-gray-500;
    }

    .project-grid:hover .project-item:hover h2 {
      @apply dark:text-[#Eaeaea] text-black;
    }
  }
</style>
